import{l as t,r as C,j as r,C as P,ba as W}from"./main.js";import{u as N,c as I}from"./main-499a499e.js";import{F as J,a as M,b as E,c as R,d as V}from"./index.esm-31eaeb1f.js";import{F as B}from"./FormControl-e1c831f9.js";import{B as k}from"./Button-53dec484.js";import"./index.esm-d52ea482.js";import"./identifier-91e83c3b.js";import"./iconBase-acf0401f.js";import"./Box-0ce68545.js";import"./Paper-1943bcb2.js";import"./utils-a4c617b5.js";const D="Upload or select %s from your WordPress media library",Y=({appId:d,columnName:o,columnValue:f,columnMetaData:x,onColumnChange:h,columnMedia:u,mediaType:p})=>{t.debug(d,o,f,x,u,p);const S=C.useRef(null),m=N(),v=s=>{if(t.debug(s),s!=null&&s.id&&(s!=null&&s.url)&&(s!=null&&s.mime)&&(s!=null&&s.title))return{value:s.id,media:{url:s.url,mime_type:s.mime,title:s.title}}},_=()=>{t.debug("update media");const s=I(x.data_type)!=="number";t.debug(s);let e="media",n="";switch(p){case"WP-Image":e="images(s)",n="image";break;case"WP-Audio":e="audio",n="audio";break;case"WP-Video":e="video(s)",n="video";break}t.debug(e,n);const a=window.wp.media({title:D.replace("%s",e),button:{text:"Select"},library:{type:n},multiple:s,render:!1});t.debug(a),a.on("select",function(){const l=[];if(s){const i=a.state().get("selection").toJSON();t.debug(i),i.map(y=>{t.debug(y);const F=v(y);F&&l.push(F)})}else{const i=v(a.state().get("selection").first().toJSON());i&&l.push(i)}t.debug(l);const c=[],g=[];for(let i=0;i<l.length;i++)c.push(l[i].value),g.push(JSON.stringify(l[i].media));t.debug(c,g),h(o,c.toString()),m(W({appId:d,columnName:o,columnValue:g}))}),a.open()},w=()=>{t.debug("delete media"),h(o,null),m(W({appId:d,columnName:o,columnValue:[]}))},A=s=>{switch(p){case"WP-Image":return r.jsx("img",{src:s.url,title:s.title,alt:s.title});case"WP-Attachment":{const e=s.mime_type.split("/");return r.jsxs("a",{href:s.url,title:s.title,target:"_blank",className:"pp-hyperlink",children:[r.jsxs("div",{children:[e[0]==="image"&&r.jsx(J,{}),e[0]==="audio"&&r.jsx(M,{}),e[0]==="video"&&r.jsx(E,{}),e[0]==="application"?e[1]==="pdf"?r.jsx(R,{}):r.jsx(V,{}):r.jsx(r.Fragment,{})]}),r.jsx("div",{className:"link-label",children:s.title})]})}case"WP-Audio":return r.jsx("audio",{controls:!0,children:r.jsx("source",{src:s.url,type:s.mime_type})});case"WP-Video":return r.jsx("video",{controls:!0,children:r.jsx("source",{src:s.url,type:s.mime_type})})}};return r.jsxs("div",{className:`media ${p}`,children:[r.jsxs(B,{children:[u==null?void 0:u.map(s=>{try{const e=JSON.parse(s);return e!=null&&e.url?r.jsx("div",{ref:S,className:"content",children:A(e)},e.url):null}catch(e){return t.error("Invalid media properties",e),r.jsx("span",{children:"Error reading media"})}}),r.jsx("input",{type:"hidden",value:f})]}),r.jsxs("div",{className:"actions",children:[r.jsx(k,{variant:"outlined",onClick:_,disabled:!P.appPlugin,children:"Select"}),r.jsx(k,{variant:"outlined",onClick:w,disabled:!P.appPlugin,children:"Delete"})]})]})};export{Y as default};
