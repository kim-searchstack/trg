import{r as m,_ as O,l as s,V as I,W as E,al as T,am as N,a7 as J,j as e,an as Q,ao as V,ap as X,aq as h,ar as Z}from"./main.js";import{u as K,v as tt,a as R,b as et,F as at,R as nt}from"./main-499a499e.js";import{S as A,c as ot}from"./index.esm-d52ea482.js";import{a as rt}from"./AdminTheme-95628d10.js";import{s as st,u as it,i as lt}from"./Actions-eda228ad.js";import{C as ct,a as mt}from"./CardContent-c5e4b8be.js";import{B as dt}from"./Box-0ce68545.js";import{C as ut}from"./CardActions-748df63c.js";import{B as v}from"./Button-53dec484.js";import"./iconBase-acf0401f.js";import"./identifier-91e83c3b.js";import"./Paper-1943bcb2.js";const ft=m.lazy(()=>O(()=>import("./Row-95b3032d.js"),["./Row-95b3032d.js","./main.js","./main-499a499e.js","./index.esm-d52ea482.js","./identifier-91e83c3b.js","./iconBase-acf0401f.js","./Box-0ce68545.js","./Paper-1943bcb2.js","./main-9fe7f77b.css","./ComputedFieldTypeEnum-9a013b11.js"],import.meta.url)),gt=({appId:r,primaryKey:i,formMode:g,showTable:u,showForm:b})=>{var P;s.debug(r,i,g);const f=K(),j=m.useMemo(()=>tt(),[]),[C,S]=m.useState(!1),[y,L]=m.useState(!1),a=I(E.getState(),r),x=a.src.dbs,p=a.src.tbl;s.debug("metaData",a,x,p);const k=R(t=>T(t,r));s.debug("data",k),m.useEffect(()=>{i===null?U():Object.keys(i).length?M():S(!0)},[i]);const M=()=>{st(x,p,i,a==null?void 0:a.media,function(t){s.debug(t),f(N({appId:r,data:t.data[0],context:t.context})),S(t!==null)})},U=()=>{if(a.columns&&Array.isArray(a.columns)){const t={};for(let n=0;n<a.columns.length;n++)t[a.columns[n].column_name]=null;s.debug(t),f(N({appId:r,data:t})),s.debug("init"),S(!0)}},w=()=>{let t="";for(const n in a.columns)a.columns[n].extra==="auto_increment"&&(t=a.columns[n].column_name);return s.debug(t),t},G=t=>{for(let n=0;n<a.columns.length;n++)if(a.columns[n].column_name===t)return a.columns[n]},q=t=>{let n=!0;const o=w();for(const l in t){const d=G(l);let c=!0;d.column_name!==o&&d.is_nullable==="NO"&&(t[l]===""||t[l]===null||t[l]===void 0)&&(f(V({appId:r,columnName:l,columnError:!0,columnText:"Field must be entered"})),c=!1,n=!1);const Y=X(E.getState(),r,l);s.debug(Y),c&&f(V({appId:r,columnName:l,columnError:!1,columnText:""}))}return n},F=t=>{const n=T(E.getState(),r);q(n)&&(i!==null?it(x,p,i,n,function(o){(o==null?void 0:o.code.toLowerCase())==="ok"?o.data==="Row successfully updated"?(L(!0),h(o.data,{variant:"success"}),t&&setTimeout(()=>{u(!0)},1e3)):o.data==="Nothing to update"&&(h(o.data,{variant:"info"}),t&&u(y)):(h("Error saving data, please check console",{variant:"error"}),s.error(o))}):lt(x,p,n,function(o){if((o==null?void 0:o.code.toLowerCase())==="ok")if(o.data==="Row successfully inserted"){if(L(!0),h(o.data,{variant:"success"}),t){u(!0);return}const l=w(),d={};for(let c=0;c<a.primary_key.length;c++)l!==""?d[a.primary_key[c]]=o.context.insert_id:d[a.primary_key[c]]=n[a.primary_key[c]];s.debug(d),b(d,nt.UPDATE)}else s.error("Invalid response"),h("Invalid response",{variant:"error"});else s.error(o)}))},z=()=>{F(!1)},W=()=>{F(!0)},B=()=>{u(y)},_=R(t=>J(t,r));s.debug("formSettings",_);const $={paddingTop:"50px",paddingBottom:"50px",paddingLeft:"50px",paddingRight:"50px"};let D="30px",H="0";return e.jsx("div",{className:`${r}_wrapper pp-form`,children:C&&k!==null?e.jsxs(ct,{sx:$,children:[e.jsx(mt,{sx:{padding:0,margin:"5px 0 0 0"},children:e.jsx("form",{id:j,className:"pp-form-content",onSubmit:t=>(t.preventDefault(),!1),children:e.jsx(dt,{className:"pp-form-grid",sx:{display:"grid",gridTemplateColumns:{lg:`repeat(${_.cellsPerRow}, 1fr)`,md:"repeat("+Math.min(_.cellsPerRow,2)+", 1fr)",xs:"1fr"},gap:D,marginBottom:0,background:_.showGrid?((P=et)==null?void 0:P.palette.mode)===Q.LIGHT?"repeating-linear-gradient( -45deg, transparent, transparent 10px, #eee 10px, #eee 20px )":"repeating-linear-gradient( -45deg, transparent, transparent 10px, #111 10px, #111 20px )":""},children:e.jsx(m.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(ft,{appId:r,dbs:x,tbl:p,metaData:a,data:k,primaryKey:i,formMode:g,formSettings:_})})})})}),e.jsx(ut,{sx:{marginTop:D,padding:0,paddingRight:H,justifyContent:"flex-end"},children:g!==at.VIEW?e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"contained",onClick:z,type:"submit",form:j,children:"APPLY"}),e.jsx(v,{variant:"outlined",onClick:W,sx:{marginLeft:"16px"},children:"OK"}),e.jsx(v,{variant:"outlined",onClick:B,sx:{marginLeft:"16px"},children:"CANCEL"})]}):e.jsx(v,{variant:"contained",onClick:B,children:"BACK"})})]}):e.jsx("div",{style:{padding:"50px"},children:e.jsx(A,{title:"Loading data..."})})})},xt=m.lazy(()=>O(()=>import("./Settings-f3e22152.js"),["./Settings-f3e22152.js","./main.js","./main-499a499e.js","./index.esm-d52ea482.js","./identifier-91e83c3b.js","./iconBase-acf0401f.js","./Box-0ce68545.js","./Paper-1943bcb2.js","./main-9fe7f77b.css","./AdminTheme-95628d10.js","./ThemeSettings-1394036c.js","./TextField-c8735bb7.js","./FormControl-e1c831f9.js","./utils-a4c617b5.js","./Select-07b752e9.js","./useFormControl-74340145.js","./Input-29494a31.js","./createSvgIcon-92c7fe83.js","./FormHelperText-ab957a1c.js","./Button-53dec484.js","./index.esm-31eaeb1f.js","./index-ad1f025d.js","./Switch-321ceb1c.js","./Close-07cb3d3a.js","./DialogContent-93dc71be.js","./FormControlLabel-8e3c3f60.js","./RadioGroup-330d4c57.js","./Radio-f4e05e00.js","./settings-d6f535d3.js","./Collapse-746eff24.js","./settings-6587c751.css","./ComputedFieldTypeEnum-9a013b11.js","./ConfirmDialog-a562852d.js","./EnumTypeEnum-7ffcf33a.js","./Actions-eda228ad.js","./CardContent-c5e4b8be.js"],import.meta.url)),yt=({appId:r,primaryKey:i,formMode:g,showTable:u,showForm:b})=>{const f=R(C=>Z(C,r)),j=rt();return e.jsxs(e.Fragment,{children:[e.jsx(gt,{appId:r,primaryKey:i,formMode:g,showTable:u,showForm:b}),f&&e.jsx(m.Suspense,{fallback:e.jsx(A,{title:"Loading form settings..."}),children:e.jsx(ot,{theme:j,children:e.jsx(xt,{appId:r})})})]})};export{yt as FormContainer,yt as default};
